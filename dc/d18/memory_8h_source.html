<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ruby: include/ruby/internal/memory.h (a5baf8d6bc4c21259705f9b4f9aa2d9b9d7ab936) Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ruby<span id="projectnumber">&#160;3.2.0dev (2022-06-11 revision 0e2c01bd094617f5c82759bdab03bb786ce89d56)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_82434f6a8a39055b35115fc8d4134985.html">ruby</a></li><li class="navelem"><a class="el" href="../../dir_d6751d5d626a7ea074f9888503e0de14.html">internal</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">memory.h</div></div>
</div><!--header-->
<div class="contents">
<a href="../../dc/d18/memory_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#ifndef RBIMPL_MEMORY_H                              </span><span class="comment">/*-*-C++-*-vi:se ft=cpp:*/</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#define RBIMPL_MEMORY_H</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;ruby/internal/config.h&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#ifdef STDC_HEADERS</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor"># include &lt;stddef.h&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#ifdef HAVE_STRING_H</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor"># include &lt;string.h&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#ifdef HAVE_STDINT_H</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor"># include &lt;stdint.h&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#ifdef HAVE_ALLOCA_H</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor"># include &lt;alloca.h&gt;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#if defined(_MSC_VER) &amp;&amp; defined(_WIN64)</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor"># include &lt;intrin.h&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor"># pragma intrinsic(_umul128)</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/ddc/alloc__size_8h.html">ruby/internal/attr/alloc_size.h</a>&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &quot;<a class="code" href="../../da/d5a/const_8h.html">ruby/internal/attr/const.h</a>&quot;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d06/constexpr_8h.html">ruby/internal/attr/constexpr.h</a>&quot;</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">#include &quot;<a class="code" href="../../d5/dc1/noalias_8h.html">ruby/internal/attr/noalias.h</a>&quot;</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d80/nonnull_8h.html">ruby/internal/attr/nonnull.h</a>&quot;</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d6f/noreturn_8h.html">ruby/internal/attr/noreturn.h</a>&quot;</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/dbd/restrict_8h.html">ruby/internal/attr/restrict.h</a>&quot;</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">#include &quot;<a class="code" href="../../d6/db2/returns__nonnull_8h.html">ruby/internal/attr/returns_nonnull.h</a>&quot;</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="preprocessor">#include &quot;ruby/internal/cast.h&quot;</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#include &quot;<a class="code" href="../../db/de3/dllexport_8h.html">ruby/internal/dllexport.h</a>&quot;</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="preprocessor">#include &quot;<a class="code" href="../../d0/dcd/include_2ruby_2internal_2has_2builtin_8h.html">ruby/internal/has/builtin.h</a>&quot;</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/df3/internal_2stdalign_8h.html">ruby/internal/stdalign.h</a>&quot;</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/d5e/stdbool_8h.html">ruby/internal/stdbool.h</a>&quot;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/de3/xmalloc_8h.html">ruby/internal/xmalloc.h</a>&quot;</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="preprocessor">#include &quot;ruby/backward/2/limits.h&quot;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/db0/backward_22_2long__long_8h.html">ruby/backward/2/long_long.h</a>&quot;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d32/backward_22_2assume_8h.html">ruby/backward/2/assume.h</a>&quot;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/db0/defines_8h.html">ruby/defines.h</a>&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="comment">/* Make alloca work the best possible way.  */</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="preprocessor">#if defined(alloca)</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor"># </span><span class="comment">/* Take that. */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="preprocessor">#elif RBIMPL_HAS_BUILTIN(__builtin_alloca)</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor"># define alloca __builtin_alloca</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="preprocessor">#elif defined(_AIX)</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="preprocessor"># pragma alloca</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#elif defined(__cplusplus)</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> *alloca(<span class="keywordtype">size_t</span>);</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="keyword">extern</span> <span class="keywordtype">void</span> *alloca();</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="preprocessor">#if defined(__DOXYGEN__)</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="keyword">typedef</span> uint128_t DSIZE_T;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="preprocessor">#elif defined(HAVE_INT128_T) &amp;&amp; SIZEOF_SIZE_T &lt;= 8</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="preprocessor"># define DSIZE_T uint128_t</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="preprocessor">#elif SIZEOF_SIZE_T * 2 &lt;= SIZEOF_LONG_LONG</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="preprocessor"># define DSIZE_T unsigned LONG_LONG</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="preprocessor">#ifdef C_ALLOCA</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="preprocessor"># define RUBY_ALLOCV_LIMIT 0</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a9dd28a544285c9a6b2eb6d1abadc45dd">  107</a></span><span class="preprocessor"># define RUBY_ALLOCV_LIMIT 1024</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="preprocessor">#ifdef __GNUC__</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a8aa2ce26d266baf56c9068a693d6073e">  161</a></span><span class="preprocessor">#define RB_GC_GUARD(v) \</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="preprocessor">    (*__extension__ ({ \</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="preprocessor">        volatile VALUE *rb_gc_guarded_ptr = &amp;(v); \</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="preprocessor">        __asm__(&quot;&quot;</span> : : &quot;m&quot;(rb_gc_guarded_ptr)); \</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        rb_gc_guarded_ptr; \</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    }))</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="preprocessor">#elif defined _MSC_VER</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="preprocessor">#define RB_GC_GUARD(v) (*rb_gc_guarded_ptr(&amp;(v)))</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="preprocessor">#define HAVE_RB_GC_GUARDED_PTR_VAL 1</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="preprocessor">#define RB_GC_GUARD(v) (*rb_gc_guarded_ptr_val(&amp;(v),(v)))</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">/* Casts needed because void* is NOT compatible with others in C++. */</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#aa0174425b708a881f776114ef4d1a470">  193</a></span><span class="preprocessor">#define RB_ALLOC_N(type,n)  RBIMPL_CAST((type *)ruby_xmalloc2((n), sizeof(type)))</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a5152faf5826149aa94dd260880bde05f">  207</a></span><span class="preprocessor">#define RB_ALLOC(type)      RBIMPL_CAST((type *)ruby_xmalloc(sizeof(type)))</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a2f680d1f7cbd85ea86ba61070cd8206a">  228</a></span><span class="preprocessor">#define RB_ZALLOC_N(type,n) RBIMPL_CAST((type *)ruby_xcalloc((n), sizeof(type)))</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a97702d29b03e291bf200732b4a84494a">  243</a></span><span class="preprocessor">#define RB_ZALLOC(type)     (RB_ZALLOC_N(type, 1))</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#adada016c349163035d66cb26faef9866">  276</a></span><span class="preprocessor">#define RB_REALLOC_N(var,type,n) \</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="preprocessor">    ((var) = RBIMPL_CAST((type *)ruby_xrealloc2((void *)(var), (n), sizeof(type))))</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a1408f4b967485afd869990b67e766ceb">  286</a></span><span class="preprocessor">#define ALLOCA_N(type,n) \</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="preprocessor">    RBIMPL_CAST((type *)alloca(rbimpl_size_mul_or_raise(sizeof(type), (n))))</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a9ab49d8b42aea6693438bcaea30befc6">  298</a></span><span class="preprocessor">#define RB_ALLOCV(v, n)        \</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="preprocessor">    ((n) &lt; RUBY_ALLOCV_LIMIT ? \</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="preprocessor">     ((v) = 0, alloca(n)) :    \</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="preprocessor">     rb_alloc_tmp_buffer(&amp;(v), (n)))</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a48da74c4df0eef40b7e471aaa1e7265f">  330</a></span><span class="preprocessor">#define RB_ALLOCV_N(type, v, n)                             \</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="preprocessor">    RBIMPL_CAST((type *)                                     \</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="preprocessor">        (((size_t)(n) &lt; RUBY_ALLOCV_LIMIT / sizeof(type)) ? \</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="preprocessor">         ((v) = 0, alloca((n) * sizeof(type))) :            \</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="preprocessor">         rb_alloc_tmp_buffer2(&amp;(v), (n), sizeof(type))))</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a9509052668c90c16bb5bfb2db47d20b0">  343</a></span><span class="preprocessor">#define RB_ALLOCV_END(v) rb_free_tmp_buffer(&amp;(v))</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a56d620b94b668ed7665d1616b2c54e48">  354</a></span><span class="preprocessor">#define MEMZERO(p,type,n) memset((p), 0, rbimpl_size_mul_or_raise(sizeof(type), (n)))</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a04ab67335215e8362c63ed27ae2d1c40">  366</a></span><span class="preprocessor">#define MEMCPY(p1,p2,type,n) memcpy((p1), (p2), rbimpl_size_mul_or_raise(sizeof(type), (n)))</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#aad09de334c9b8c7f717d314b14679e62">  378</a></span><span class="preprocessor">#define MEMMOVE(p1,p2,type,n) memmove((p1), (p2), rbimpl_size_mul_or_raise(sizeof(type), (n)))</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a42f38632bba2bb73abb03716754f3230">  391</a></span><span class="preprocessor">#define MEMCMP(p1,p2,type,n) memcmp((p1), (p2), rbimpl_size_mul_or_raise(sizeof(type), (n)))</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga84cab8c1fdb7dbb9707b4e6e50f98a46">  393</a></span><span class="preprocessor">#define ALLOC_N    RB_ALLOC_N    </span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga1d44ee5d34e399ff293db2925d49f45b">  394</a></span><span class="preprocessor">#define ALLOC      RB_ALLOC      </span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga76d668f1abc12b06cce5aa812ffe3272">  395</a></span><span class="preprocessor">#define ZALLOC_N   RB_ZALLOC_N   </span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga5977753a684c6ecac43297762b2191f3">  396</a></span><span class="preprocessor">#define ZALLOC     RB_ZALLOC     </span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga131cf3c08712a1da7eb3e95fa0ce68f4">  397</a></span><span class="preprocessor">#define REALLOC_N  RB_REALLOC_N  </span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#ga1712308e175c5501b8153e71d14b9709">  398</a></span><span class="preprocessor">#define ALLOCV     RB_ALLOCV     </span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#gac386bc13233e78e797d06ef0ba17f0ca">  399</a></span><span class="preprocessor">#define ALLOCV_N   RB_ALLOCV_N   </span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno"><a class="line" href="../../dd/dd3/group__deprecated__macros.html#gaf855fa62bc8e618e3fb5876fde1a6088">  400</a></span><span class="preprocessor">#define ALLOCV_END RB_ALLOCV_END </span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="keyword">struct </span><a class="code hl_struct" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html">rbimpl_size_mul_overflow_tag</a> {</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno"><a class="line" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html#a997e48d877de9568f273c2673d588c04">  414</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html#a997e48d877de9568f273c2673d588c04">left</a>;                  </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html#a077a401b0fddf742bbc9e552e95dd1b3">right</a>;               </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>};</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><a class="code hl_define" href="../../db/de3/dllexport_8h.html#afec5f752a293fd0190a27d9c3ef8d61c">RBIMPL_SYMBOL_EXPORT_BEGIN</a>()</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><a class="code hl_define" href="../../d8/dbd/restrict_8h.html#ada18074a85e5086502045a655676fc3e">RBIMPL_ATTR_RESTRICT</a>()</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><a class="code hl_define" href="../../d6/db2/returns__nonnull_8h.html#a2dc0acf64b236c4614859bf80189710b">RBIMPL_ATTR_RETURNS_NONNULL</a>()</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><a class="code hl_define" href="../../d8/ddc/alloc__size_8h.html#ac4aaef439426290c6c317486118b0c7e">RBIMPL_ATTR_ALLOC_SIZE</a>((2))</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><a class="code hl_define" href="../../de/d80/nonnull_8h.html#a8d2d1d045d991c6a92d3c7b68d5627f1">RBIMPL_ATTR_NONNULL</a>(())</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="keywordtype">void</span> *rb_alloc_tmp_buffer(volatile VALUE *store, <span class="keywordtype">long</span> len);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><a class="code hl_define" href="../../d8/dbd/restrict_8h.html#ada18074a85e5086502045a655676fc3e">RBIMPL_ATTR_RESTRICT</a>()</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span><a class="code hl_define" href="../../d6/db2/returns__nonnull_8h.html#a2dc0acf64b236c4614859bf80189710b">RBIMPL_ATTR_RETURNS_NONNULL</a>()</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><a class="code hl_define" href="../../d8/ddc/alloc__size_8h.html#ac4aaef439426290c6c317486118b0c7e">RBIMPL_ATTR_ALLOC_SIZE</a>((2,3))</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span><a class="code hl_define" href="../../de/d80/nonnull_8h.html#a8d2d1d045d991c6a92d3c7b68d5627f1">RBIMPL_ATTR_NONNULL</a>(())</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="keywordtype">void</span> *rb_alloc_tmp_buffer_with_count(volatile VALUE *store, <span class="keywordtype">size_t</span> len,<span class="keywordtype">size_t</span> count);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span><span class="keywordtype">void</span> rb_free_tmp_buffer(volatile VALUE *store);</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><a class="code hl_function" href="../../dd/d83/include_2ruby_2io_8h.html#a5fca161ca820b389a1e8f98a5d0347cd">RBIMPL_ATTR_NORETURN</a>()</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="keywordtype">void</span> ruby_malloc_size_overflow(<span class="keywordtype">size_t</span> x, <span class="keywordtype">size_t</span> y);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="preprocessor">#ifdef HAVE_RB_GC_GUARDED_PTR_VAL</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="keyword">volatile</span> VALUE *rb_gc_guarded_ptr_val(<span class="keyword">volatile</span> VALUE *ptr, VALUE val);</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><a class="code hl_define" href="../../db/de3/dllexport_8h.html#af121a028f9aea98bce3a094766d1e792">RBIMPL_SYMBOL_EXPORT_END</a>()</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="preprocessor"># pragma optimize(&quot;&quot;</span>, off)</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">volatile</span> VALUE *</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>rb_gc_guarded_ptr(<span class="keyword">volatile</span> VALUE *ptr)</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>{</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="keywordflow">return</span> ptr;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>}</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="preprocessor"># pragma optimize(&quot;&quot;</span>, on)</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a5bb057f288675b15a39d255040ecbdb1">  525</a></span><a class="code hl_function" href="../../dc/d18/memory_8h.html#a5bb057f288675b15a39d255040ecbdb1">rb_mul_size_overflow</a>(<span class="keywordtype">size_t</span> a, <span class="keywordtype">size_t</span> b, <span class="keywordtype">size_t</span> max, <span class="keywordtype">size_t</span> *c)</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>{</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="preprocessor">#ifdef DSIZE_T</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <a class="code hl_define" href="../../d8/db0/defines_8h.html#abd8f5a190fd0bc9b362cf4833b80765f">RB_GNUC_EXTENSION</a> DSIZE_T da, db, c2;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    da = a;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    db = b;</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    c2 = da * db;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">if</span> (c2 &gt; max) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    *c = RBIMPL_CAST((<span class="keywordtype">size_t</span>)c2);</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <span class="keywordflow">if</span> (b != 0 &amp;&amp; a &gt; max / b) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    *c = a * b;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>}</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="preprocessor">#if defined(__DOXYGEN__)</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><a class="code hl_define" href="../../d1/d06/constexpr_8h.html#a03b087dd5dddbcaabc26c61cbe08a7b2">RBIMPL_ATTR_CONSTEXPR</a>(CXX14)</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="preprocessor">#elif RBIMPL_COMPILER_SINCE(GCC, 7, 0, 0)</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><a class="code hl_define" href="../../d1/d06/constexpr_8h.html#a03b087dd5dddbcaabc26c61cbe08a7b2">RBIMPL_ATTR_CONSTEXPR</a>(CXX14) <span class="comment">/* https://gcc.gnu.org/bugzilla/show_bug.cgi?id=70507 */</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="preprocessor">#elif RBIMPL_COMPILER_SINCE(Clang, 7, 0, 0)</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><a class="code hl_define" href="../../d1/d06/constexpr_8h.html#a03b087dd5dddbcaabc26c61cbe08a7b2">RBIMPL_ATTR_CONSTEXPR</a>(CXX14) <span class="comment">/* https://bugs.llvm.org/show_bug.cgi?id=37633 */</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><a class="code hl_function" href="../../dd/d83/include_2ruby_2io_8h.html#a1750807e1f8a49bf477553f311033bf3">RBIMPL_ATTR_CONST</a>()</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>static inline struct <a class="code hl_struct" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html">rbimpl_size_mul_overflow_tag</a></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>rbimpl_size_mul_overflow(<span class="keywordtype">size_t</span> x, <span class="keywordtype">size_t</span> y)</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>{</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html">rbimpl_size_mul_overflow_tag</a> ret = { <span class="keyword">false</span>,  0, };</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="preprocessor">#if RBIMPL_HAS_BUILTIN(__builtin_mul_overflow)</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    ret.left = __builtin_mul_overflow(x, y, &amp;ret.right);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="preprocessor">#elif defined(DSIZE_T)</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <a class="code hl_define" href="../../d8/db0/defines_8h.html#abd8f5a190fd0bc9b362cf4833b80765f">RB_GNUC_EXTENSION</a> DSIZE_T dx = x;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <a class="code hl_define" href="../../d8/db0/defines_8h.html#abd8f5a190fd0bc9b362cf4833b80765f">RB_GNUC_EXTENSION</a> DSIZE_T dy = y;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <a class="code hl_define" href="../../d8/db0/defines_8h.html#abd8f5a190fd0bc9b362cf4833b80765f">RB_GNUC_EXTENSION</a> DSIZE_T dz = dx * dy;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    ret.left  = dz &gt; SIZE_MAX;</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    ret.right = RBIMPL_CAST((<span class="keywordtype">size_t</span>)dz);</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span> </div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="preprocessor">#elif defined(_MSC_VER) &amp;&amp; defined(_WIN64)</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    <span class="keywordtype">unsigned</span> __int64 dp = 0;</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordtype">unsigned</span> __int64 dz = _umul128(x, y, &amp;dp);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    ret.left  = RBIMPL_CAST((<span class="keywordtype">bool</span>)dp);</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    ret.right = RBIMPL_CAST((<span class="keywordtype">size_t</span>)dz);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    <span class="comment">/* https://wiki.sei.cmu.edu/confluence/display/c/INT30-C.+Ensure+that+unsigned+integer+operations+do+not+wrap */</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    ret.left  = (y != 0) &amp;&amp; (x &gt; SIZE_MAX / y);</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    ret.right = x * y;</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span> </div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>}</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">size_t</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>rbimpl_size_mul_or_raise(<span class="keywordtype">size_t</span> x, <span class="keywordtype">size_t</span> y)</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>{</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html">rbimpl_size_mul_overflow_tag</a> size =</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        rbimpl_size_mul_overflow(x, y);</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="../../d1/d32/backward_22_2assume_8h.html#a1b75702b5e5d862321e2da4dfc2a826e">RB_LIKELY</a>(! size.left)) {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        <span class="keywordflow">return</span> size.right;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        ruby_malloc_size_overflow(x, y);</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        <a class="code hl_define" href="../../dc/d4a/internal_2assume_8h.html#a3ef40254971ef2fcfe300b7eff6ec9e1">RBIMPL_UNREACHABLE_RETURN</a>(0);</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    }</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>}</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno"><a class="line" href="../../dc/d18/memory_8h.html#a1e69043808389952f8117f2d85f79f97">  640</a></span><a class="code hl_function" href="../../dc/d18/memory_8h.html#a1e69043808389952f8117f2d85f79f97">rb_alloc_tmp_buffer2</a>(<span class="keyword">volatile</span> VALUE *store, <span class="keywordtype">long</span> count, <span class="keywordtype">size_t</span> elsize)</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>{</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> total_size = rbimpl_size_mul_or_raise(count, elsize);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> cnt = (total_size + <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="../../d4/d3f/value_8h.html#af5fa1600fbcceb5c1bbe27dd3eaab113">VALUE</a>) - 1) / <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="../../d4/d3f/value_8h.html#af5fa1600fbcceb5c1bbe27dd3eaab113">VALUE</a>);</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="keywordflow">return</span> rb_alloc_tmp_buffer_with_count(store, total_size, cnt);</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>}</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="preprocessor">#if ! defined(__MINGW32__) &amp;&amp; ! defined(__DOXYGEN__)</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><a class="code hl_define" href="../../db/de3/dllexport_8h.html#afec5f752a293fd0190a27d9c3ef8d61c">RBIMPL_SYMBOL_EXPORT_BEGIN</a>()</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><a class="code hl_define" href="../../d5/dc1/noalias_8h.html#a5f66a13022be0ccee54ab966552b78a3">RBIMPL_ATTR_NOALIAS</a>()</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><a class="code hl_define" href="../../de/d80/nonnull_8h.html#a8d2d1d045d991c6a92d3c7b68d5627f1">RBIMPL_ATTR_NONNULL</a>((1))</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><a class="code hl_define" href="../../d6/db2/returns__nonnull_8h.html#a2dc0acf64b236c4614859bf80189710b">RBIMPL_ATTR_RETURNS_NONNULL</a>()</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="comment">/* At least since 2004, glibc&#39;s &lt;string.h&gt; annotates memcpy to be</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span><span class="comment"> * __attribute__((__nonnull__(1, 2))).  However it is safe to pass NULL to the</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span><span class="comment"> * source pointer, if n is 0.  Let&#39;s wrap memcpy. */</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>static inline <span class="keywordtype">void</span> *</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>ruby_nonempty_memcpy(<span class="keywordtype">void</span> *dest, const <span class="keywordtype">void</span> *src, <span class="keywordtype">size_t</span> n)</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>{</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="keywordflow">if</span> (n) {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <span class="keywordflow">return</span> memcpy(dest, src, n);</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    }</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <span class="keywordflow">return</span> dest;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>}</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><a class="code hl_define" href="../../db/de3/dllexport_8h.html#af121a028f9aea98bce3a094766d1e792">RBIMPL_SYMBOL_EXPORT_END</a>()</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="preprocessor">#undef memcpy</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="preprocessor">#define memcpy ruby_nonempty_memcpy</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span><span class="preprocessor">#endif </span><span class="comment">/* RBIMPL_MEMORY_H */</span><span class="preprocessor"></span></div>
<div class="ttc" id="aalloc__size_8h_html"><div class="ttname"><a href="../../d8/ddc/alloc__size_8h.html">alloc_size.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_ALLOC_SIZE.</div></div>
<div class="ttc" id="aalloc__size_8h_html_ac4aaef439426290c6c317486118b0c7e"><div class="ttname"><a href="../../d8/ddc/alloc__size_8h.html#ac4aaef439426290c6c317486118b0c7e">RBIMPL_ATTR_ALLOC_SIZE</a></div><div class="ttdeci">#define RBIMPL_ATTR_ALLOC_SIZE(tuple)</div><div class="ttdoc">Wraps (or simulates) __attribute__((alloc_size))</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddc/alloc__size_8h_source.html#l00027">alloc_size.h:27</a></div></div>
<div class="ttc" id="abackward_22_2assume_8h_html"><div class="ttname"><a href="../../d1/d32/backward_22_2assume_8h.html">assume.h</a></div><div class="ttdoc">Defines ASSUME / RB_LIKELY / UNREACHABLE.</div></div>
<div class="ttc" id="abackward_22_2assume_8h_html_a1b75702b5e5d862321e2da4dfc2a826e"><div class="ttname"><a href="../../d1/d32/backward_22_2assume_8h.html#a1b75702b5e5d862321e2da4dfc2a826e">RB_LIKELY</a></div><div class="ttdeci">#define RB_LIKELY(x)</div><div class="ttdoc">Asserts that the given Boolean expression likely holds.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/backward_22_2assume_8h_source.html#l00043">assume.h:43</a></div></div>
<div class="ttc" id="abackward_22_2long__long_8h_html"><div class="ttname"><a href="../../d7/db0/backward_22_2long__long_8h.html">long_long.h</a></div><div class="ttdoc">Defines old LONG_LONG.</div></div>
<div class="ttc" id="aconst_8h_html"><div class="ttname"><a href="../../da/d5a/const_8h.html">const.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_CONST.</div></div>
<div class="ttc" id="aconstexpr_8h_html"><div class="ttname"><a href="../../d1/d06/constexpr_8h.html">constexpr.h</a></div><div class="ttdoc">RBIMPL_ATTR_CONSTEXPR.</div></div>
<div class="ttc" id="aconstexpr_8h_html_a03b087dd5dddbcaabc26c61cbe08a7b2"><div class="ttname"><a href="../../d1/d06/constexpr_8h.html#a03b087dd5dddbcaabc26c61cbe08a7b2">RBIMPL_ATTR_CONSTEXPR</a></div><div class="ttdeci">#define RBIMPL_ATTR_CONSTEXPR(_)</div><div class="ttdoc">Wraps (or simulates) C++11 constexpr.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d06/constexpr_8h_source.html#l00074">constexpr.h:74</a></div></div>
<div class="ttc" id="adefines_8h_html"><div class="ttname"><a href="../../d8/db0/defines_8h.html">defines.h</a></div></div>
<div class="ttc" id="adefines_8h_html_abd8f5a190fd0bc9b362cf4833b80765f"><div class="ttname"><a href="../../d8/db0/defines_8h.html#abd8f5a190fd0bc9b362cf4833b80765f">RB_GNUC_EXTENSION</a></div><div class="ttdeci">#define RB_GNUC_EXTENSION</div><div class="ttdoc">This is expanded to nothing for non-GCC compilers.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/db0/defines_8h_source.html#l00089">defines.h:89</a></div></div>
<div class="ttc" id="adllexport_8h_html"><div class="ttname"><a href="../../db/de3/dllexport_8h.html">dllexport.h</a></div><div class="ttdoc">Tweaking visibility of C variables/functions.</div></div>
<div class="ttc" id="adllexport_8h_html_af121a028f9aea98bce3a094766d1e792"><div class="ttname"><a href="../../db/de3/dllexport_8h.html#af121a028f9aea98bce3a094766d1e792">RBIMPL_SYMBOL_EXPORT_END</a></div><div class="ttdeci">#define RBIMPL_SYMBOL_EXPORT_END()</div><div class="ttdoc">Counterpart of RBIMPL_SYMBOL_EXPORT_BEGIN.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de3/dllexport_8h_source.html#l00106">dllexport.h:106</a></div></div>
<div class="ttc" id="adllexport_8h_html_afec5f752a293fd0190a27d9c3ef8d61c"><div class="ttname"><a href="../../db/de3/dllexport_8h.html#afec5f752a293fd0190a27d9c3ef8d61c">RBIMPL_SYMBOL_EXPORT_BEGIN</a></div><div class="ttdeci">#define RBIMPL_SYMBOL_EXPORT_BEGIN()</div><div class="ttdoc">Shortcut macro equivalent to RUBY_SYMBOL_EXPORT_BEGIN extern &quot;C&quot; {.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de3/dllexport_8h_source.html#l00097">dllexport.h:97</a></div></div>
<div class="ttc" id="ainclude_2ruby_2internal_2has_2builtin_8h_html"><div class="ttname"><a href="../../d0/dcd/include_2ruby_2internal_2has_2builtin_8h.html">builtin.h</a></div><div class="ttdoc">Defines RBIMPL_HAS_BUILTIN.</div></div>
<div class="ttc" id="ainclude_2ruby_2io_8h_html_a1750807e1f8a49bf477553f311033bf3"><div class="ttname"><a href="../../dd/d83/include_2ruby_2io_8h.html#a1750807e1f8a49bf477553f311033bf3">RBIMPL_ATTR_CONST</a></div><div class="ttdeci">RBIMPL_ATTR_CONST() int rb_io_oflags_fmode(int oflags)</div><div class="ttdoc">Converts an oflags (that rb_io_modestr_oflags() returns) to a fmode (that rb_io_mode_flags() returns)...</div></div>
<div class="ttc" id="ainclude_2ruby_2io_8h_html_a5fca161ca820b389a1e8f98a5d0347cd"><div class="ttname"><a href="../../dd/d83/include_2ruby_2io_8h.html#a5fca161ca820b389a1e8f98a5d0347cd">RBIMPL_ATTR_NORETURN</a></div><div class="ttdeci">RBIMPL_ATTR_NORETURN() void rb_eof_error(void)</div><div class="ttdoc">Utility function to raise rb_eEOFError.</div></div>
<div class="ttc" id="ainternal_2assume_8h_html_a3ef40254971ef2fcfe300b7eff6ec9e1"><div class="ttname"><a href="../../dc/d4a/internal_2assume_8h.html#a3ef40254971ef2fcfe300b7eff6ec9e1">RBIMPL_UNREACHABLE_RETURN</a></div><div class="ttdeci">#define RBIMPL_UNREACHABLE_RETURN(_)</div><div class="ttdoc">Wraps (or simulates) __builtin_unreachable.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4a/internal_2assume_8h_source.html#l00042">assume.h:42</a></div></div>
<div class="ttc" id="ainternal_2stdalign_8h_html"><div class="ttname"><a href="../../d4/df3/internal_2stdalign_8h.html">stdalign.h</a></div><div class="ttdoc">Defines RBIMPL_ALIGNAS / RBIMPL_ALIGNOF.</div></div>
<div class="ttc" id="amemory_8h_html_a1e69043808389952f8117f2d85f79f97"><div class="ttname"><a href="../../dc/d18/memory_8h.html#a1e69043808389952f8117f2d85f79f97">rb_alloc_tmp_buffer2</a></div><div class="ttdeci">static void * rb_alloc_tmp_buffer2(volatile VALUE *store, long count, size_t elsize)</div><div class="ttdoc">This is an implementation detail of RB_ALLOCV_N().</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d18/memory_8h_source.html#l00640">memory.h:640</a></div></div>
<div class="ttc" id="amemory_8h_html_a5bb057f288675b15a39d255040ecbdb1"><div class="ttname"><a href="../../dc/d18/memory_8h.html#a5bb057f288675b15a39d255040ecbdb1">rb_mul_size_overflow</a></div><div class="ttdeci">static int rb_mul_size_overflow(size_t a, size_t b, size_t max, size_t *c)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d18/memory_8h_source.html#l00525">memory.h:525</a></div></div>
<div class="ttc" id="anoalias_8h_html"><div class="ttname"><a href="../../d5/dc1/noalias_8h.html">noalias.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_NOALIAS.</div></div>
<div class="ttc" id="anoalias_8h_html_a5f66a13022be0ccee54ab966552b78a3"><div class="ttname"><a href="../../d5/dc1/noalias_8h.html#a5f66a13022be0ccee54ab966552b78a3">RBIMPL_ATTR_NOALIAS</a></div><div class="ttdeci">#define RBIMPL_ATTR_NOALIAS()</div><div class="ttdoc">Wraps (or simulates) __declspec((noalias))</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc1/noalias_8h_source.html#l00062">noalias.h:62</a></div></div>
<div class="ttc" id="anonnull_8h_html"><div class="ttname"><a href="../../de/d80/nonnull_8h.html">nonnull.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_NONNULL.</div></div>
<div class="ttc" id="anonnull_8h_html_a8d2d1d045d991c6a92d3c7b68d5627f1"><div class="ttname"><a href="../../de/d80/nonnull_8h.html#a8d2d1d045d991c6a92d3c7b68d5627f1">RBIMPL_ATTR_NONNULL</a></div><div class="ttdeci">#define RBIMPL_ATTR_NONNULL(list)</div><div class="ttdoc">Wraps (or simulates) __attribute__((nonnull))</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d80/nonnull_8h_source.html#l00027">nonnull.h:27</a></div></div>
<div class="ttc" id="anoreturn_8h_html"><div class="ttname"><a href="../../de/d6f/noreturn_8h.html">noreturn.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_NORETURN.</div></div>
<div class="ttc" id="arestrict_8h_html"><div class="ttname"><a href="../../d8/dbd/restrict_8h.html">restrict.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_RESTRICT.</div></div>
<div class="ttc" id="arestrict_8h_html_ada18074a85e5086502045a655676fc3e"><div class="ttname"><a href="../../d8/dbd/restrict_8h.html#ada18074a85e5086502045a655676fc3e">RBIMPL_ATTR_RESTRICT</a></div><div class="ttdeci">#define RBIMPL_ATTR_RESTRICT()</div><div class="ttdoc">Wraps (or simulates) __declspec(restrict)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dbd/restrict_8h_source.html#l00035">restrict.h:35</a></div></div>
<div class="ttc" id="areturns__nonnull_8h_html"><div class="ttname"><a href="../../d6/db2/returns__nonnull_8h.html">returns_nonnull.h</a></div><div class="ttdoc">Defines RBIMPL_ATTR_RETURNS_NONNULL.</div></div>
<div class="ttc" id="areturns__nonnull_8h_html_a2dc0acf64b236c4614859bf80189710b"><div class="ttname"><a href="../../d6/db2/returns__nonnull_8h.html#a2dc0acf64b236c4614859bf80189710b">RBIMPL_ATTR_RETURNS_NONNULL</a></div><div class="ttdeci">#define RBIMPL_ATTR_RETURNS_NONNULL()</div><div class="ttdoc">Wraps (or simulates) __attribute__((returns_nonnull))</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db2/returns__nonnull_8h_source.html#l00031">returns_nonnull.h:31</a></div></div>
<div class="ttc" id="astdbool_8h_html"><div class="ttname"><a href="../../d9/d5e/stdbool_8h.html">stdbool.h</a></div><div class="ttdoc">C99 shim for &lt;stdbool.h&gt;</div></div>
<div class="ttc" id="astructrbimpl__size__mul__overflow__tag_html"><div class="ttname"><a href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html">rbimpl_size_mul_overflow_tag</a></div><div class="ttdoc">This is an implementation detail of rbimpl_size_mul_overflow().</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/rb__mjit__min__header-2_88_80_8h_source.html#l12669">rb_mjit_min_header-2.8.0.h:12669</a></div></div>
<div class="ttc" id="astructrbimpl__size__mul__overflow__tag_html_a077a401b0fddf742bbc9e552e95dd1b3"><div class="ttname"><a href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html#a077a401b0fddf742bbc9e552e95dd1b3">rbimpl_size_mul_overflow_tag::right</a></div><div class="ttdeci">size_t right</div><div class="ttdoc">Multiplication result.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dec/rb__mjit__min__header-2_88_80_8h_source.html#l12671">rb_mjit_min_header-2.8.0.h:12671</a></div></div>
<div class="ttc" id="astructrbimpl__size__mul__overflow__tag_html_a997e48d877de9568f273c2673d588c04"><div class="ttname"><a href="../../dd/d25/structrbimpl__size__mul__overflow__tag.html#a997e48d877de9568f273c2673d588c04">rbimpl_size_mul_overflow_tag::left</a></div><div class="ttdeci">bool left</div><div class="ttdoc">Whether overflow happened or not.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d18/memory_8h_source.html#l00414">memory.h:414</a></div></div>
<div class="ttc" id="avalue_8h_html_af5fa1600fbcceb5c1bbe27dd3eaab113"><div class="ttname"><a href="../../d4/d3f/value_8h.html#af5fa1600fbcceb5c1bbe27dd3eaab113">VALUE</a></div><div class="ttdeci">uintptr_t VALUE</div><div class="ttdoc">Type that represents a Ruby object.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3f/value_8h_source.html#l00040">value.h:40</a></div></div>
<div class="ttc" id="axmalloc_8h_html"><div class="ttname"><a href="../../d8/de3/xmalloc_8h.html">xmalloc.h</a></div><div class="ttdoc">Declares ruby_xmalloc().</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ruby: include/ruby/thread.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ruby<span id="projectnumber">&#160;3.2.0dev (2022-06-11 revision 0e2c01bd094617f5c82759bdab03bb786ce89d56)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_82434f6a8a39055b35115fc8d4134985.html">ruby</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">thread.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<h3 class="version">(9125374726fbf68c05ee7585d4a374ffc5efc5db)</h3><div class="textblock"><code>#include &quot;<a class="el" href="../../de/d80/nonnull_8h_source.html">ruby/internal/attr/nonnull.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h_source.html">ruby/internal/intern/thread.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/de3/dllexport_8h_source.html">ruby/internal/dllexport.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for thread.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d93/include_2ruby_2thread_8h__incl.png" border="0" usemap="#ainclude_2ruby_2thread_8h" alt=""/></div>
<map name="ainclude_2ruby_2thread_8h" id="ainclude_2ruby_2thread_8h">
<area shape="rect" title=" " alt="" coords="1194,5,1353,32"/>
<area shape="rect" href="../../de/d80/nonnull_8h.html" title="Defines RBIMPL_ATTR_NONNULL." alt="" coords="1207,169,1339,211"/>
<area shape="rect" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html" title="Public APIs related to rb_cThread." alt="" coords="1068,80,1215,121"/>
<area shape="rect" href="../../db/de3/dllexport_8h.html" title="Tweaking visibility of C variables/functions." alt="" coords="1272,423,1448,449"/>
<area shape="rect" href="../../d3/d7c/attribute_8h.html" title="Defines RBIMPL_HAS_ATTRIBUTE." alt="" coords="1019,594,1221,621"/>
<area shape="rect" href="../../db/d16/config_8h_source.html" title=" " alt="" coords="669,683,827,710"/>
<area shape="rect" href="../../dc/db4/compiler__since_8h.html" title="Defines RBIMPL_COMPILER_SINCE." alt="" coords="549,765,712,807"/>
<area shape="rect" title=" " alt="" coords="736,773,843,799"/>
<area shape="rect" href="../../df/dec/compiler__is_8h.html" title="Defines RBIMPL_COMPILER_IS." alt="" coords="1098,855,1289,881"/>
<area shape="rect" href="../../d2/d6e/apple_8h_source.html" title=" " alt="" coords="1205,1108,1368,1149"/>
<area shape="rect" href="../../de/dbb/clang_8h_source.html" title=" " alt="" coords="900,1019,1063,1060"/>
<area shape="rect" href="../../d4/d99/gcc_8h_source.html" title=" " alt="" coords="1172,929,1335,971"/>
<area shape="rect" href="../../d5/d80/intel_8h_source.html" title=" " alt="" coords="1087,1019,1249,1060"/>
<area shape="rect" href="../../d4/dac/msvc_8h_source.html" title=" " alt="" coords="935,929,1097,971"/>
<area shape="rect" href="../../da/d2d/sunpro_8h_source.html" title=" " alt="" coords="1409,929,1572,971"/>
<area shape="rect" href="../../dc/d2b/cast_8h_source.html" title=" " alt="" coords="94,594,239,621"/>
<area shape="rect" href="../../d4/d3f/value_8h.html" title="Defines VALUE and ID." alt="" coords="841,177,996,203"/>
<area shape="rect" href="../../de/ddd/has_2warning_8h.html" title="Defines RBIMPL_HAS_WARNING." alt="" coords="337,683,535,710"/>
<area shape="rect" href="../../d4/d28/warning__push_8h.html" title="Defines RBIMPL_WARNING_PUSH." alt="" coords="154,676,313,717"/>
<area shape="rect" href="../../d6/d78/include_2ruby_2internal_2static__assert_8h.html" title="Defines RBIMPL_STATIC_ASSERT." alt="" coords="764,259,905,300"/>
<area shape="rect" href="../../d7/db0/backward_22_2long__long_8h.html" title="Defines old LONG_LONG." alt="" coords="315,587,474,628"/>
<area shape="rect" href="../../d9/d86/limits_8h_source.html" title=" " alt="" coords="721,505,897,531"/>
<area shape="rect" href="../../dc/da7/assert_8h.html" title=" " alt="" coords="712,348,784,375"/>
<area shape="rect" href="../../d8/d3b/extension_8h.html" title="Defines RBIMPL_HAS_EXTENSION." alt="" coords="817,348,1023,375"/>
<area shape="rect" href="../../dc/d4a/internal_2assume_8h.html" title="Defines RBIMPL_ASSUME / RBIMPL_UNREACHABLE." alt="" coords="428,505,596,531"/>
<area shape="rect" href="../../dc/d79/cold_8h.html" title="Defines RBIMPL_ATTR_COLD." alt="" coords="1130,497,1262,539"/>
<area shape="rect" href="../../de/d6f/noreturn_8h.html" title="Defines RBIMPL_ATTR_NORETURN." alt="" coords="922,497,1054,539"/>
<area shape="rect" href="../../d1/d32/backward_22_2assume_8h.html" title="Defines ASSUME / RB_LIKELY / UNREACHABLE." alt="" coords="519,423,710,449"/>
<area shape="rect" href="../../d0/dcd/include_2ruby_2internal_2has_2builtin_8h.html" title="Defines RBIMPL_HAS_BUILTIN." alt="" coords="550,594,735,621"/>
<area shape="rect" href="../../d8/d8d/cpp__attribute_8h.html" title="Defines RBIMPL_HAS_CPP_ATTRIBUTE." alt="" coords="1115,676,1272,717"/>
<area shape="rect" href="../../d4/d58/declspec__attribute_8h.html" title="Defines RBIMPL_HAS_DECLSPEC_ATTRIBUTE." alt="" coords="851,676,1039,717"/>
<area shape="rect" href="../../d2/d74/feature_8h.html" title="Defines RBIMPL_HAS_FEATURE." alt="" coords="837,423,1030,449"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d8/d79/include_2ruby_2thread_8h__dep__incl.png" border="0" usemap="#ainclude_2ruby_2thread_8hdep" alt=""/></div>
<map name="ainclude_2ruby_2thread_8hdep" id="ainclude_2ruby_2thread_8hdep">
<area shape="rect" title=" " alt="" coords="316,5,475,32"/>
<area shape="rect" href="../../d1/dcc/bignum_8c_source.html" title=" " alt="" coords="5,80,84,107"/>
<area shape="rect" href="../../de/d32/dir_8c_source.html" title=" " alt="" coords="108,80,155,107"/>
<area shape="rect" href="../../d6/d13/file_8c_source.html" title=" " alt="" coords="179,80,230,107"/>
<area shape="rect" href="../../d8/d16/gc_8c_source.html" title=" " alt="" coords="255,80,301,107"/>
<area shape="rect" href="../../df/d0a/io_8c_source.html" title=" " alt="" coords="326,80,369,107"/>
<area shape="rect" href="../../d7/d5a/mjit__worker_8c_source.html" title=" " alt="" coords="393,80,496,107"/>
<area shape="rect" href="../../d0/d85/process_8c_source.html" title=" " alt="" coords="520,80,599,107"/>
<area shape="rect" href="../../da/d2d/ractor_8c_source.html" title=" " alt="" coords="623,80,690,107"/>
<area shape="rect" href="../../df/d77/ruby_8c_source.html" title=" " alt="" coords="715,80,775,107"/>
<area shape="rect" href="../../d3/de7/thread_8c_source.html" title=" " alt="" coords="799,80,872,107"/>
</map>
</div>
</div>
<p><a href="../../d6/dfb/include_2ruby_2thread_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa3f21b9c9afc9020902bc05861cd1e98"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#aa3f21b9c9afc9020902bc05861cd1e98">RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_AFTER</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:aa3f21b9c9afc9020902bc05861cd1e98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac68da3f59d8f2a0eac775c14a5c164e1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ac68da3f59d8f2a0eac775c14a5c164e1">RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_</a></td></tr>
<tr class="separator:ac68da3f59d8f2a0eac775c14a5c164e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af17b9da6a94fea18d7f5fced36e26383"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#af17b9da6a94fea18d7f5fced36e26383">RUBY_INTERNAL_THREAD_EVENT_READY</a>&#160;&#160;&#160;0x01 /** acquiring GVL */</td></tr>
<tr class="separator:af17b9da6a94fea18d7f5fced36e26383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8aa2e3829bb17a6fe557ea935a80460f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a8aa2e3829bb17a6fe557ea935a80460f">RUBY_INTERNAL_THREAD_EVENT_RESUMED</a>&#160;&#160;&#160;0x02 /** acquired GVL */</td></tr>
<tr class="separator:a8aa2e3829bb17a6fe557ea935a80460f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd714df3df47d055fe8daf9d2d19b8d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#abd714df3df47d055fe8daf9d2d19b8d9">RUBY_INTERNAL_THREAD_EVENT_SUSPENDED</a>&#160;&#160;&#160;0x04 /** released GVL */</td></tr>
<tr class="separator:abd714df3df47d055fe8daf9d2d19b8d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a017b46f975082d4566d20e521daeed9c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a017b46f975082d4566d20e521daeed9c">RUBY_INTERNAL_THREAD_EVENT_MASK</a>&#160;&#160;&#160;0x07 /** All Thread events */</td></tr>
<tr class="separator:a017b46f975082d4566d20e521daeed9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Flags for rb_nogvl()</div></td></tr>
<tr class="memitem:a43015d3aa38191d7f3fd4bf3f8d4ffeb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a43015d3aa38191d7f3fd4bf3f8d4ffeb">RB_NOGVL_INTR_FAIL</a>&#160;&#160;&#160;(0x1)</td></tr>
<tr class="memdesc:a43015d3aa38191d7f3fd4bf3f8d4ffeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Passing this flag to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea" title="Identical to rb_thread_call_without_gvl(), except it additionally takes &quot;flags&quot; that change the behav...">rb_nogvl()</a> prevents it from checking interrupts.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a43015d3aa38191d7f3fd4bf3f8d4ffeb">More...</a><br /></td></tr>
<tr class="separator:a43015d3aa38191d7f3fd4bf3f8d4ffeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18e3feab6fca543b044c314ba8057676"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a18e3feab6fca543b044c314ba8057676">RB_NOGVL_UBF_ASYNC_SAFE</a>&#160;&#160;&#160;(0x2)</td></tr>
<tr class="memdesc:a18e3feab6fca543b044c314ba8057676"><td class="mdescLeft">&#160;</td><td class="mdescRight">Passing this flag to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea" title="Identical to rb_thread_call_without_gvl(), except it additionally takes &quot;flags&quot; that change the behav...">rb_nogvl()</a> indicates that the passed UBF is async-signal-safe.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a18e3feab6fca543b044c314ba8057676">More...</a><br /></td></tr>
<tr class="separator:a18e3feab6fca543b044c314ba8057676"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac9d5584fef027f99bce1be4dd724ccac"><td class="memItemLeft" align="right" valign="top">typedef void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ac9d5584fef027f99bce1be4dd724ccac">rb_internal_thread_event_data_t</a></td></tr>
<tr class="separator:ac9d5584fef027f99bce1be4dd724ccac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a366fa0c7393b136682002af54720a88b"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a366fa0c7393b136682002af54720a88b">rb_internal_thread_event_callback</a>) (<a class="el" href="../../dd/d20/event_8h.html#acd6117b16c5028f1d3a764c63e13416c">rb_event_flag_t</a> event, const rb_internal_thread_event_data_t *event_data, void *user_data)</td></tr>
<tr class="separator:a366fa0c7393b136682002af54720a88b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a357076a234eecfbd8ab9f24c2ab33b85"><td class="memItemLeft" align="right" valign="top">typedef struct rb_internal_thread_event_hook&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a357076a234eecfbd8ab9f24c2ab33b85">rb_internal_thread_event_hook_t</a></td></tr>
<tr class="separator:a357076a234eecfbd8ab9f24c2ab33b85"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6314dab336c3763a51e2b01775b4fe2e"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a6314dab336c3763a51e2b01775b4fe2e">rb_thread_call_with_gvl</a> (void *(*func)(void *), void *data1)</td></tr>
<tr class="memdesc:a6314dab336c3763a51e2b01775b4fe2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Re-)acquires the GVL.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a6314dab336c3763a51e2b01775b4fe2e">More...</a><br /></td></tr>
<tr class="separator:a6314dab336c3763a51e2b01775b4fe2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7b1a7070f6f9553cf247686ff797e6e"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e">rb_thread_call_without_gvl</a> (void *(*func)(void *), void *data1, <a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *ubf, void *data2)</td></tr>
<tr class="memdesc:ae7b1a7070f6f9553cf247686ff797e6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows the passed function to run in parallel with other Ruby threads.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e">More...</a><br /></td></tr>
<tr class="separator:ae7b1a7070f6f9553cf247686ff797e6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d1d67a30f8463da7e1f8c784f752084"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a9d1d67a30f8463da7e1f8c784f752084">rb_thread_call_without_gvl2</a> (void *(*func)(void *), void *data1, <a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *ubf, void *data2)</td></tr>
<tr class="memdesc:a9d1d67a30f8463da7e1f8c784f752084"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identical to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e" title="Allows the passed function to run in parallel with other Ruby threads.">rb_thread_call_without_gvl()</a>, except it does not interface with signals etc.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a9d1d67a30f8463da7e1f8c784f752084">More...</a><br /></td></tr>
<tr class="separator:a9d1d67a30f8463da7e1f8c784f752084"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a3b3894d9685de0e3a640d1645b33ea"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea">rb_nogvl</a> (void *(*func)(void *), void *data1, <a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *ubf, void *data2, int flags)</td></tr>
<tr class="memdesc:a5a3b3894d9685de0e3a640d1645b33ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identical to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e" title="Allows the passed function to run in parallel with other Ruby threads.">rb_thread_call_without_gvl()</a>, except it additionally takes "flags" that change the behaviour.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea">More...</a><br /></td></tr>
<tr class="separator:a5a3b3894d9685de0e3a640d1645b33ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed265565b49e85be95f3c824a3c2085"><td class="memItemLeft" align="right" valign="top">rb_internal_thread_event_hook_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a8ed265565b49e85be95f3c824a3c2085">rb_internal_thread_add_event_hook</a> (rb_internal_thread_event_callback func, <a class="el" href="../../dd/d20/event_8h.html#acd6117b16c5028f1d3a764c63e13416c">rb_event_flag_t</a> events, void *data)</td></tr>
<tr class="memdesc:a8ed265565b49e85be95f3c824a3c2085"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a thread event hook function.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#a8ed265565b49e85be95f3c824a3c2085">More...</a><br /></td></tr>
<tr class="separator:a8ed265565b49e85be95f3c824a3c2085"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af11db9f313ff09d56b901ccceebd07ef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#af11db9f313ff09d56b901ccceebd07ef">rb_internal_thread_remove_event_hook</a> (rb_internal_thread_event_hook_t *hook)</td></tr>
<tr class="memdesc:af11db9f313ff09d56b901ccceebd07ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unregister the passed hook.  <a href="../../d6/dfb/include_2ruby_2thread_8h.html#af11db9f313ff09d56b901ccceebd07ef">More...</a><br /></td></tr>
<tr class="separator:af11db9f313ff09d56b901ccceebd07ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd></dd></dl>
<dl class="section rcs"><dt>Author</dt><dd>matz </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Tue Jul 10 17:35:43 JST 2012 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2007 Yukihiro Matsumoto </dd>
<dd>
This file is a part of the programming language Ruby. Permission is hereby granted, to either redistribute and/or modify this file, provided that the conditions mentioned in the file COPYING are met. Consult the file for details. </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a43015d3aa38191d7f3fd4bf3f8d4ffeb" name="a43015d3aa38191d7f3fd4bf3f8d4ffeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43015d3aa38191d7f3fd4bf3f8d4ffeb">&#9670;&nbsp;</a></span>RB_NOGVL_INTR_FAIL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RB_NOGVL_INTR_FAIL&#160;&#160;&#160;(0x1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Passing this flag to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea" title="Identical to rb_thread_call_without_gvl(), except it additionally takes &quot;flags&quot; that change the behav...">rb_nogvl()</a> prevents it from checking interrupts. </p>
<p >Interrupts can impact your program negatively. For instance consider following callback function:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> fd; <span class="comment">// set elsewhere.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">auto</span> callback(<span class="keyword">auto</span> buf) {</div>
<div class="line">  <span class="keyword">auto</span> tmp = <a class="code hl_function" href="../../d8/de3/xmalloc_8h.html#aa3b4330a47b221ee106833fdffeffe7c">ruby_xmalloc</a>(BUFSIZ);</div>
<div class="line">  <span class="keyword">auto</span> ret = <a class="code hl_function" href="../../d8/de3/xmalloc_8h.html#aa3b4330a47b221ee106833fdffeffe7c">ruby_xmalloc</a>(<span class="keyword">sizeof</span>(ssize_t));  <span class="comment">// (a)</span></div>
<div class="line">  <span class="keyword">auto</span> n = read(fd, tmp, BUFSIZ);            <span class="comment">// (b)</span></div>
<div class="line">  memcpy(buf, tmp, n);                       <span class="comment">// (c)</span></div>
<div class="line">  memcpy(ret, n, <span class="keyword">sizeof</span>(n));</div>
<div class="line">  <a class="code hl_function" href="../../d8/de3/xmalloc_8h.html#a7196f140bd2dd83bc786d06ce283cd0e">ruby_xfree</a>(tmp);</div>
<div class="line">  <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="ttc" id="axmalloc_8h_html_a7196f140bd2dd83bc786d06ce283cd0e"><div class="ttname"><a href="../../d8/de3/xmalloc_8h.html#a7196f140bd2dd83bc786d06ce283cd0e">ruby_xfree</a></div><div class="ttdeci">void ruby_xfree(void *ptr)</div><div class="ttdoc">Deallocates a storage instance.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d16/gc_8c_source.html#l12226">gc.c:12226</a></div></div>
<div class="ttc" id="axmalloc_8h_html_aa3b4330a47b221ee106833fdffeffe7c"><div class="ttname"><a href="../../d8/de3/xmalloc_8h.html#aa3b4330a47b221ee106833fdffeffe7c">ruby_xmalloc</a></div><div class="ttdeci">void * ruby_xmalloc(size_t size)</div><div class="ttdoc">Allocates a storage instance.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d16/gc_8c_source.html#l14161">gc.c:14161</a></div></div>
</div><!-- fragment --><p >Here, if it gets interrupted at (a) or (b), <code>read(2)</code> is cancelled and this function leaks memory (which is not a good thing of course, but...). But if it gets interrupted at (c), where <code>read(2)</code> is already done, interruption is way more catastrophic because what was read gets lost. To reroute this kind of problem you should set this flag. And check interrupts elsewhere at your own risk. </p>

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00048">48</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="a18e3feab6fca543b044c314ba8057676" name="a18e3feab6fca543b044c314ba8057676"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18e3feab6fca543b044c314ba8057676">&#9670;&nbsp;</a></span>RB_NOGVL_UBF_ASYNC_SAFE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RB_NOGVL_UBF_ASYNC_SAFE&#160;&#160;&#160;(0x2)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Passing this flag to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a5a3b3894d9685de0e3a640d1645b33ea" title="Identical to rb_thread_call_without_gvl(), except it additionally takes &quot;flags&quot; that change the behav...">rb_nogvl()</a> indicates that the passed UBF is async-signal-safe. </p>
<p >An UBF could be async safe, and that makes things simpler. However async unsafe UBFs are just okay. If unsure, you can safely leave it unspecified. </p>

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00060">60</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="ac68da3f59d8f2a0eac775c14a5c164e1" name="ac68da3f59d8f2a0eac775c14a5c164e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac68da3f59d8f2a0eac775c14a5c164e1">&#9670;&nbsp;</a></span>RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000352">Deprecated:</a></b></dt><dd>It seems even in the old days it made no sense...? </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00191">191</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="aa3f21b9c9afc9020902bc05861cd1e98" name="aa3f21b9c9afc9020902bc05861cd1e98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3f21b9c9afc9020902bc05861cd1e98">&#9670;&nbsp;</a></span>RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_AFTER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_CALL_WO_GVL_FLAG_SKIP_CHECK_INTS_AFTER&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000351">Deprecated:</a></b></dt><dd>This macro once was a thing in the old days, but makes no sense any longer today. Exists here for backwards compatibility only. You can safely forget about it. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00185">185</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="a017b46f975082d4566d20e521daeed9c" name="a017b46f975082d4566d20e521daeed9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a017b46f975082d4566d20e521daeed9c">&#9670;&nbsp;</a></span>RUBY_INTERNAL_THREAD_EVENT_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_INTERNAL_THREAD_EVENT_MASK&#160;&#160;&#160;0x07 /** All Thread events */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00196">196</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="af17b9da6a94fea18d7f5fced36e26383" name="af17b9da6a94fea18d7f5fced36e26383"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af17b9da6a94fea18d7f5fced36e26383">&#9670;&nbsp;</a></span>RUBY_INTERNAL_THREAD_EVENT_READY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_INTERNAL_THREAD_EVENT_READY&#160;&#160;&#160;0x01 /** acquiring GVL */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00193">193</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="a8aa2e3829bb17a6fe557ea935a80460f" name="a8aa2e3829bb17a6fe557ea935a80460f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8aa2e3829bb17a6fe557ea935a80460f">&#9670;&nbsp;</a></span>RUBY_INTERNAL_THREAD_EVENT_RESUMED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_INTERNAL_THREAD_EVENT_RESUMED&#160;&#160;&#160;0x02 /** acquired GVL */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00194">194</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="abd714df3df47d055fe8daf9d2d19b8d9" name="abd714df3df47d055fe8daf9d2d19b8d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd714df3df47d055fe8daf9d2d19b8d9">&#9670;&nbsp;</a></span>RUBY_INTERNAL_THREAD_EVENT_SUSPENDED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_INTERNAL_THREAD_EVENT_SUSPENDED&#160;&#160;&#160;0x04 /** released GVL */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00195">195</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a366fa0c7393b136682002af54720a88b" name="a366fa0c7393b136682002af54720a88b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a366fa0c7393b136682002af54720a88b">&#9670;&nbsp;</a></span>rb_internal_thread_event_callback</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* rb_internal_thread_event_callback) (<a class="el" href="../../dd/d20/event_8h.html#acd6117b16c5028f1d3a764c63e13416c">rb_event_flag_t</a> event, const rb_internal_thread_event_data_t *event_data, void *user_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00200">200</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="ac9d5584fef027f99bce1be4dd724ccac" name="ac9d5584fef027f99bce1be4dd724ccac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9d5584fef027f99bce1be4dd724ccac">&#9670;&nbsp;</a></span>rb_internal_thread_event_data_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void rb_internal_thread_event_data_t</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00198">198</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<a id="a357076a234eecfbd8ab9f24c2ab33b85" name="a357076a234eecfbd8ab9f24c2ab33b85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a357076a234eecfbd8ab9f24c2ab33b85">&#9670;&nbsp;</a></span>rb_internal_thread_event_hook_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct rb_internal_thread_event_hook rb_internal_thread_event_hook_t</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html#l00203">203</a> of file <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h_source.html">thread.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8ed265565b49e85be95f3c824a3c2085" name="a8ed265565b49e85be95f3c824a3c2085"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ed265565b49e85be95f3c824a3c2085">&#9670;&nbsp;</a></span>rb_internal_thread_add_event_hook()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rb_internal_thread_event_hook_t * rb_internal_thread_add_event_hook </td>
          <td>(</td>
          <td class="paramtype">rb_internal_thread_event_callback&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d20/event_8h.html#acd6117b16c5028f1d3a764c63e13416c">rb_event_flag_t</a>&#160;</td>
          <td class="paramname"><em>events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a thread event hook function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>A callback. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">events</td><td>A set of events that <code>func</code> should run. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Passed as-is to <code>func</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An opaque pointer to the hook, to unregister it later. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This functionality is a noop on Windows. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This function MUST not be called from a thread event callback. </dd></dl>

</div>
</div>
<a id="af11db9f313ff09d56b901ccceebd07ef" name="af11db9f313ff09d56b901ccceebd07ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af11db9f313ff09d56b901ccceebd07ef">&#9670;&nbsp;</a></span>rb_internal_thread_remove_event_hook()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rb_internal_thread_remove_event_hook </td>
          <td>(</td>
          <td class="paramtype">rb_internal_thread_event_hook_t *&#160;</td>
          <td class="paramname"><em>hook</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unregister the passed hook. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hook.</td><td>The hook to unregister. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Wether the hook was found and unregistered. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This functionality is a noop on Windows. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This function MUST not be called from a thread event callback. </dd></dl>

</div>
</div>
<a id="a5a3b3894d9685de0e3a640d1645b33ea" name="a5a3b3894d9685de0e3a640d1645b33ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a3b3894d9685de0e3a640d1645b33ea">&#9670;&nbsp;</a></span>rb_nogvl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * rb_nogvl </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *&#160;</td>
          <td class="paramname"><em>ubf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identical to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e" title="Allows the passed function to run in parallel with other Ruby threads.">rb_thread_call_without_gvl()</a>, except it additionally takes "flags" that change the behaviour. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>A function to call without GVL. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data1</td><td>Passed as-is to <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ubf</td><td>An UBF to cancel <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data2</td><td>Passed as-is to <code>ubf</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Flags. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>What <code>func</code> returned, or 0 in case <code>func</code> did not return. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/de7/thread_8c_source.html#l01486">1486</a> of file <a class="el" href="../../d3/de7/thread_8c_source.html">thread.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/de7/thread_8c_source.html#l01617">rb_thread_call_without_gvl2()</a>.</p>

</div>
</div>
<a id="a6314dab336c3763a51e2b01775b4fe2e" name="a6314dab336c3763a51e2b01775b4fe2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6314dab336c3763a51e2b01775b4fe2e">&#9670;&nbsp;</a></span>rb_thread_call_with_gvl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * rb_thread_call_with_gvl </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Re-)acquires the GVL. </p>
<p >This manoeuvre makes it possible for an out-of-GVL routine to one-shot call a ruby method.</p>
<p >What this function does:</p>
<ol type="1">
<li>Blocks until it acquires the GVL.</li>
<li>Calls the passed function.</li>
<li>Releases the GVL.</li>
<li>Returns what was returned form the passed function.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>What to call with GVL. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data1</td><td>Passed as-is to <code>func</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>What was returned from <code>func</code>. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><code>func</code> must not return a Ruby object. If it did such return value would escape from GC's scope; would not be marked. </dd>
<dd>
Global escapes from this function just yield whatever fatal undefined behaviours. You must make sure that <code>func</code> does not raise, by properly rescuing everything using e.g. <a class="el" href="../../db/d55/include_2ruby_2internal_2intern_2proc_8h.html#a9c9bb71ac479f9b6d5799bcd99dcac1e" title="Protects a function call from potential global escapes from the function.">rb_protect()</a>. </dd>
<dd>
You cannot convert a non-Ruby thread into a Ruby thread using this API. This function makes sense only from inside of a <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e" title="Allows the passed function to run in parallel with other Ruby threads.">rb_thread_call_without_gvl()</a>'s callback. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/de7/thread_8c_source.html#l01708">1708</a> of file <a class="el" href="../../d3/de7/thread_8c_source.html">thread.c</a>.</p>

</div>
</div>
<a id="ae7b1a7070f6f9553cf247686ff797e6e" name="ae7b1a7070f6f9553cf247686ff797e6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7b1a7070f6f9553cf247686ff797e6e">&#9670;&nbsp;</a></span>rb_thread_call_without_gvl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * rb_thread_call_without_gvl </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *&#160;</td>
          <td class="paramname"><em>ubf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allows the passed function to run in parallel with other Ruby threads. </p>
<p >What this function does:</p>
<ol type="1">
<li>Checks (and handles) pending interrupts.</li>
<li>Releases the GVL. (Others can run here in parallel...)</li>
<li>Calls the passed function.</li>
<li>Blocks until it re-acquires the GVL.</li>
<li>Checks interrupts that happened between 2 to 4.</li>
</ol>
<p >In case other threads interfaced with this thread using <a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a3b589c6cbb1ea96a3b1a25ea76f40a77" title="Terminates the given thread.">rb_thread_kill()</a> etc., the passed UBF is additionally called. See <a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71" title="This is the type of UBFs.">rb_unblock_function_t</a> for details.</p>
<p >Unlike <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a9d1d67a30f8463da7e1f8c784f752084" title="Identical to rb_thread_call_without_gvl(), except it does not interface with signals etc.">rb_thread_call_without_gvl2()</a> this function also reacts to signals etc.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>A function to call without GVL. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data1</td><td>Passed as-is to <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ubf</td><td>An UBF to cancel <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data2</td><td>Passed as-is to <code>ubf</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>What <code>func</code> returned, or 0 in case <code>ubf</code> cancelled <code>func</code>. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>You cannot use most of Ruby C APIs like calling methods or raising exceptions from any of the functions passed to it. If that is dead necessary use <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a6314dab336c3763a51e2b01775b4fe2e" title="(Re-)acquires the GVL.">rb_thread_call_with_gvl()</a> to re-acquire the GVL. </dd>
<dd>
In short, this API is difficult. @ko1 recommends you to use other ways if any. We lack experiences to use this API. If you find any corner cases etc., please report it to the devs. </dd>
<dd>
Releasing and re-acquiring the GVL are expensive operations. For a short-running <code>func</code>, it might be faster to just call <code>func</code> with blocking everything else. Be sure to benchmark your code to see if it is actually worth releasing the GVL. </dd></dl>

</div>
</div>
<a id="a9d1d67a30f8463da7e1f8c784f752084" name="a9d1d67a30f8463da7e1f8c784f752084"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d1d67a30f8463da7e1f8c784f752084">&#9670;&nbsp;</a></span>rb_thread_call_without_gvl2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * rb_thread_call_without_gvl2 </td>
          <td>(</td>
          <td class="paramtype">void *(*)(void *)&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d64/include_2ruby_2internal_2intern_2thread_8h.html#a9054f0c75a418c4dc919eb47616f3d71">rb_unblock_function_t</a> *&#160;</td>
          <td class="paramname"><em>ubf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identical to <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#ae7b1a7070f6f9553cf247686ff797e6e" title="Allows the passed function to run in parallel with other Ruby threads.">rb_thread_call_without_gvl()</a>, except it does not interface with signals etc. </p>
<p >As described in <a class="el" href="../../d6/dfb/include_2ruby_2thread_8h.html#a43015d3aa38191d7f3fd4bf3f8d4ffeb" title="Passing this flag to rb_nogvl() prevents it from checking interrupts.">RB_NOGVL_INTR_FAIL</a>, interrupts can hurt you. In case this function detects an interrupt, it returns immediately. You can record progress of your callback and check it after returning from this function.</p>
<p >What this function does:</p>
<ol type="1">
<li>Checks for pending interrupts and if any, just returns.</li>
<li>Releases the GVL. (Others can run here in parallel...)</li>
<li>Calls the passed function.</li>
<li>Blocks until it re-acquires the GVL.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">func</td><td>A function to call without GVL. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data1</td><td>Passed as-is to <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ubf</td><td>An UBF to cancel <code>func</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data2</td><td>Passed as-is to <code>ubf</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>What <code>func</code> returned, or 0 in case <code>func</code> did not return. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/de7/thread_8c_source.html#l01617">1617</a> of file <a class="el" href="../../d3/de7/thread_8c_source.html">thread.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
